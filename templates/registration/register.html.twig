{% extends 'base.html.twig' %}

{% block title %}Enrôlement – Team Rocket & Co{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    <!-- Polices & icônes -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root{
            --clr-bg:#0b0b0b;--clr-primary:#8b0000;--clr-secondary:#111;
            --clr-text:#f0f0f0;--clr-accent:#ffcc00;
            --ff-body:'Roboto',sans-serif;--ff-title:'Orbitron',sans-serif;
        }
        body{
            background:var(--clr-bg);color:var(--clr-text);
            font-family:var(--ff-body);display:flex;justify-content:center;
            align-items:center;min-height:100vh;margin:0;padding:20px;
        }

        .enrol-card{
            position:relative;width:100%;max-width:480px;
            background:rgba(0,0,0,.65);border:2px solid var(--clr-primary);
            border-radius:16px;padding:2.5rem;box-shadow:0 0 20px rgba(139,0,0,.5);
            animation:fadeIn .8s ease-out;
        }
        @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}

        .enrol-title{
            font-family:var(--ff-title);font-size:1.8rem;text-align:center;
            margin-bottom:1.5rem;color:var(--clr-accent);text-shadow:0 0 6px var(--clr-accent);
        }

        .form-group{margin-bottom:1.2rem}
        .form-label{display:block;margin-bottom:.4rem;font-weight:700;font-size:.9rem}
        .form-control{
            width:100%;padding:.75rem 1rem;border:1px solid #444;
            border-radius:8px;background:#1e1e1e;color:var(--clr-text);
            transition:border-color .3s,box-shadow .3s;
        }
        .form-control:focus{
            border-color:var(--clr-accent);
            box-shadow:0 0 8px var(--clr-accent);outline:none;
        }

        .team-select-group{
            padding:1rem;border:2px dashed #444;border-radius:12px;margin-bottom:1.5rem;
        }
        .team-display{
            display:flex;align-items:center;gap:1rem;margin-bottom:1rem;
        }
        .team-logo-select{
            width:50px;height:50px;border-radius:50%;display:grid;place-content:center;
            font-family:var(--ff-title);font-size:1.5rem;color:#fff;
            border:3px solid;transition:all .4s;
        }
        .team-info-select strong{display:block;font-size:1rem}
        .team-info-select small{color:#aaa}

        .btn-submit{
            width:100%;padding:1rem;font-family:var(--ff-title);font-size:1.1rem;
            background:var(--clr-primary);color:#fff;border:none;border-radius:8px;
            cursor:pointer;transition:background .3s,transform .1s,box-shadow .3s;
            box-shadow:0 5px 15px rgba(139,0,0,.4);
        }
        .btn-submit:hover{background:#ffcc00;color:#000;box-shadow:0 8px 25px rgba(255,204,0,.6)}
        .btn-submit:active{transform:translateY(0)}
    </style>
{% endblock %}

{% block body %}
<div class="enrol-card">
    <h1 class="enrol-title">ENVOLEZ-VOUS VERS LE MAL</h1>

    {{ form_start(registrationForm) }}

        <!-- Email -->
        <div class="form-group">
            {{ form_label(registrationForm.email, 'Email de contact') }}
            {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control','placeholder':'votre.nom@team.com'}}) }}
            {{ form_errors(registrationForm.email) }}
        </div>

        <!-- Nom de code -->
        <div class="form-group">
            {{ form_label(registrationForm.codename, 'Nom de code') }}
            {{ form_widget(registrationForm.codename, {'attr': {'class': 'form-control','placeholder':'Ex: Glitch, Nova…'}}) }}
            {{ form_errors(registrationForm.codename) }}
        </div>

        <!-- Choix de la team -->
        <div class="team-select-group">
            {{ form_label(registrationForm.teamVilain, 'Organisation') }}

            <div class="team-display">
                <div class="team-logo-select" id="team-logo-select">?</div>
                <div class="team-info-select">
                    <strong id="team-name-select">Sélectionnez une team</strong>
                    <small id="team-credo-select">Leur devise apparaîtra ici</small>
                </div>
            </div>

            {{ form_widget(registrationForm.teamVilain, {'attr': {'class': 'form-control','id':'team-select'}}) }}
            {{ form_errors(registrationForm.teamVilain) }}
        </div>

        <!-- Mots de passe -->
        <div class="form-group">
            {{ form_label(registrationForm.plainPassword.first, 'Mot de passe') }}
            {{ form_widget(registrationForm.plainPassword.first, {'attr': {'class': 'form-control','placeholder':'Au moins 6 caractères'}}) }}
            {{ form_errors(registrationForm.plainPassword.first) }}
        </div>
        <div class="form-group">
            {{ form_label(registrationForm.plainPassword.second, 'Confirmation') }}
            {{ form_widget(registrationForm.plainPassword.second, {'attr': {'class': 'form-control','placeholder':'Retapez le mot de passe'}}) }}
            {{ form_errors(registrationForm.plainPassword.second) }}
        </div>

        <button type="submit" class="btn-submit">ACTIVER L'IDENTIFIANT</button>

    {{ form_end(registrationForm) }}
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        /* Mise à jour visuelle au changement de team */
        const select   = document.getElementById('team-select');
        const logo     = document.getElementById('team-logo-select');
        const name     = document.getElementById('team-name-select');
        const credo    = document.getElementById('team-credo-select');

        /* Données injectées côté serveur (JSON valide) */
        const teams = {{ teamsDetails|json_encode|raw }};

        function updateTeamDisplay(id){
            const t = teams.find(x => x.id == id);
            if (!t) return;

            logo.textContent               = t.name.charAt(0).toUpperCase();
            logo.style.backgroundColor     = t.colorCode;
            logo.style.borderColor         = t.colorCode;
            name.textContent               = t.name;
            credo.textContent              = t.credo;
        }

        select.addEventListener('change', () => updateTeamDisplay(select.value));
        updateTeamDisplay(select.value); // initial
    </script>
{% endblock %}

{% block footer %}{% endblock %}