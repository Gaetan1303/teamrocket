{% extends 'base.html.twig' %}

{% block title %}Connexion – Team Rocket & Co{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    <!-- Polices -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root{
            --clr-bg:#0b0b0b;--clr-primary:#8b0000;--clr-secondary:#111;
            --clr-text:#f0f0f0;--clr-accent:#ffcc00;
            --ff-body:'Roboto',sans-serif;--ff-title:'Orbitron',sans-serif;
        }
        body{
            background:var(--clr-bg);color:var(--clr-text);
            font-family:var(--ff-body);display:flex;justify-content:center;
            align-items:center;min-height:100vh;margin:0;padding:20px;
        }

        .login-card{
            width:100%;max-width:400px;
            background:rgba(0,0,0,.65);border:2px solid var(--clr-primary);
            border-radius:16px;padding:2.5rem;box-shadow:0 0 20px rgba(139,0,0,.5);
            animation:fadeIn .8s ease-out;
        }
        @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}

        .login-title{
            font-family:var(--ff-title);font-size:1.6rem;text-align:center;
            margin-bottom:2rem;color:var(--clr-accent);text-shadow:0 0 6px var(--clr-accent);
        }

        .form-group{margin-bottom:1.2rem}
        .form-label{display:block;margin-bottom:.4rem;font-weight:700;font-size:.9rem}
        .form-control{
            width:100%;padding:.75rem 1rem;border:1px solid #444;
            border-radius:8px;background:#1e1e1e;color:var(--clr-text);
            transition:border-color .3s,box-shadow .3s;
        }
        .form-control:focus{
            border-color:var(--clr-accent);
            box-shadow:0 0 8px var(--clr-accent);outline:none;
        }

        .btn-login{
            width:100%;padding:1rem;font-family:var(--ff-title);font-size:1.1rem;
            background:var(--clr-primary);color:#fff;border:none;border-radius:8px;
            cursor:pointer;transition:background .3s,transform .1s,box-shadow .3s;
            box-shadow:0 5px 15px rgba(139,0,0,.4);
        }
        .btn-login:hover{background:#ffcc00;color:#000;box-shadow:0 8px 25px rgba(255,204,0,.6)}
        .btn-login:active{transform:translateY(0)}

        .alert-danger{
            background:rgba(220,20,60,.15);border:1px solid crimson;
            color:crimson;border-radius:8px;padding:.75rem 1rem;margin-bottom:1rem;
            font-size:.9rem;
        }

        .extra-links{
            text-align:center;margin-top:1.2rem;font-size:.85rem;
        }
        .extra-links a{color:var(--clr-accent);text-decoration:none;}
        .extra-links a:hover{text-decoration:underline;}
    </style>
{% endblock %}

{% block body %}
<div class="login-card">
    <h1 class="login-title">CONNEXION</h1>

    {% for flash in app.flashes('error') %}
        <div class="alert alert-danger">{{ flash }}</div>
    {% endfor %}

    <form id="loginForm" data-turbo="false">
        <div class="form-group">
            <label for="inputEmail" class="form-label">Adresse e-mail</label>
            <input type="email" name="email" id="inputEmail" class="form-control" required autofocus>
        </div>

        <div class="form-group">
            <label for="inputPassword" class="form-label">Mot de passe</label>
            <input type="password" name="password" id="inputPassword" class="form-control" required>
        </div>

        <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
        <button class="btn-login" type="submit">SE CONNECTER</button>
    </form>
    <div class="extra-links">
        <a href="{{ path('app_register') }}">Pas encore enrôlé ?</a>
    </div>
</div>
<script>
console.log('Login script loaded');

document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = new URLSearchParams({
        email: document.getElementById('inputEmail').value,
        password: document.getElementById('inputPassword').value,
        _csrf_token: document.querySelector('input[name="_csrf_token"]').value
    });

    const res = await fetch('{{ path('app_login_post') }}', {
        method: 'POST',
        credentials: 'same-origin',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: data
    });

    if (res.ok && res.redirected) {
        window.location.href = res.url;
    } else {
        location.reload(); 
    }
});
</script>
{% endblock %}

{% block javascripts %}
{{ parent() }}

{% endblock %}

{% block footer %}
{% endblock %}